<!-- <label for="category_id">Category:</label><br>
            <select id="category_id" name="category_id" onchange="filterSubcategories()">
                <option value="">Category</option>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select><br><br>
            
            <label for="subcategory_id">Subcategory:</label><br>
            <select id="subcategory_id" name="subcategory_id">
                <option value="">SubCategory</option>
                {% for subcategory in subcategories %}
                <option value="{{ subcategory.id }}" data-category-id="{{ subcategory.category_id }}">{{ subcategory.name }}</option>
                {% endfor %}
            </select><br><br>
        </select><br><br> -->
        {% extends "base.html" %}

        {% block title %}{% if query %}Edit Query{% else %}Add Query{% endif %}{% endblock %}
        
        {% block content %}
        
        <div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-color text-white d-flex justify-content-center">
                        <h4 class="mb-0">{% if query %}Edit Query{% else %} Queries{% endif %}</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST" class="mt-3">
                            <input type="hidden" name="query_id" value="{{ query.id if query else '' }}">
        
                            <div class="mb-3">
                                <label for="category_id" class="form-label">Category:</label>
                                <select id="category_id" name="category_id" class="form-select" onchange="updateSubcategories()" required>
                                    <option value="">Select Category</option>
                                    {% for category in categories %}
                                    <option value="{{ category.id }}" {% if query and query.subcategory and query.subcategory.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">Please select a category.</div>
                            </div>
        
                            <div class="mb-3">
                                <label for="subcategory_id" class="form-label">Subcategory:</label>
                                <select id="subcategory_id" name="subcategory_id" class="form-select" required>
                                    <option value="">Select Subcategory</option>
                                    {% for subcategory in subcategories %}
                                    <option value="{{ subcategory.id }}" {% if query and query.subcategory_id == subcategory.id %}selected{% endif %} data-category="{{ subcategory.category_id }}">{{ subcategory.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">Please select a subcategory.</div>
                            </div>        
                            <div class="mb-3 form-group">
                                <label for="name" class="form-label">Name:</label>
                                <input type="text" id="name" name="name" class="form-control" placeholder="Enter your name" value="{{ query.name if query else '' }}" required>
                                <div class="invalid-feedback">Please enter a name.</div>
                            </div>
        
                            <div class="mb-3">
                                <label for="email" class="form-label">Email:</label>
                                <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" value="{{ query.email if query else '' }}" required>
                                <div class="invalid-feedback">Please enter a valid email.</div>
                            </div>
        
                            <div class="mb-3">
                                <label for="address" class="form-label">Address:</label>
                                <input type="text" id="address" name="address" class="form-control" placeholder="Enter your address" value="{{ query.address if query else '' }}" required>
                                <div class="invalid-feedback">Please enter an address.</div>
                            </div>

                        <div class="mb-3">
                        <label for="phone1" class="form-label">Phone 1:</label>
                        <input type="text" id="phone1" name="phone1" class="form-control" placeholder="Enter your phone number" value="{{ query.phone1 if query else '' }}">
                    </div>

                    <div class="mb-3">
                        <label for="phone2" class="form-label">Phone 2:</label>
                        <input type="text" id="phone2" name="phone2" class="form-control" placeholder="Enter an additional phone number" value="{{ query.phone2 if query else '' }}">
                    </div>

                    <div class="mb-3">
                        <label for="mobile" class="form-label">Mobile:</label>
                        <input type="text" id="mobile" name="mobile" class="form-control" placeholder="Enter your mobile number" value="{{ query.mobile if query else '' }}">
                    </div>

                    <div class="mb-3">
                        <label for="remarks" class="form-label">Remarks:</label>
                        <textarea id="remarks" name="remarks" class="form-control" rows="3">{{ query.remarks if query else '' }}</textarea>
                    </div>

                <div class="mb-3">
                <label for="date" class="form-label">Date:</label><br>
                <input type="date" id="date" name="date" class="form-control datepicker " value="{{ query.date if query else today }}">
               </div>
           

                <div class="d-grid gap-2">
                    <button type="submit" class="btn bg-color btn-lg button-bg">{% if query %}Update Query{% else %}Add Query{% endif %}</button>
                </div>
            </form>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-dark container w-75 text-center text-white bg-blue mt-3">
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
            <div class="mt-3 text-center">
                <a href="{{ url_for('query') }}" class="btn btn-outline-dark-blue rounded-pill">View All Queries</a>
            </div>
            
        </div>
    </div>
</div>
</div>
</div>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    updateSubcategories();
                });
        
                function updateSubcategories() {
                    var categorySelect = document.getElementById('category_id');
                    var subcategorySelect = document.getElementById('subcategory_id');
                    var selectedCategoryId = categorySelect.value;
        
                    for (var i = 0; i < subcategorySelect.options.length; i++) {
                        var option = subcategorySelect.options[i];
                        option.style.display = option.getAttribute('data-category') == selectedCategoryId ? 'block' : 'none';
                    }
                }
        
                function today() {
                    var today = new Date();
                    var day = String(today.getDate()).padStart(2, '0');
                    var month = String(today.getMonth() + 1).padStart(2, '0');
                    var year = today.getFullYear();
                    return year + '-' + month + '-' + day;
                }
            </script>
        {% endblock %}
        